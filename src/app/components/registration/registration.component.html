<h4 class="mb-4">User Registration</h4>

@if(!registrationStatus.success) {

<form [formGroup]="form" class="d-flex flex-column">

    <mat-form-field>
        <mat-label>
            First Name
        </mat-label>
        <input matInput type="text" formControlName="firstName">
        @if(form.get('firstName').invalid && form.get('firstName').touched) {
            <mat-error>
               {{form.get('firstName').hasError('minLength') ? form.get('firstName').getError('message') : 'First Name is required'}} 
            </mat-error>
        }
    </mat-form-field>

    <mat-form-field>
        <mat-label>
            Last Name
        </mat-label>
        <input matInput type="text" formControlName="lastName">
        @if(form.get('lastName').invalid && form.get('lastName').touched) {
        <mat-error>
            {{form.get('lastName').hasError('minLength') ? form.get('lastName').getError('message') : 'Last Name is required'}}
        </mat-error>
        }
    </mat-form-field>

    <mat-form-field>
        <mat-label>
            Email
        </mat-label>
        <input matInput type="text" formControlName="email">
        @if(form.get('email').hasError("duplicateEmail")) {
        <mat-error>Email is already registered</mat-error>
        } @else {
        @if(form.get('email').invalid && form.get('email').touched) {
        <mat-error>
            Email is missing or invalid
        </mat-error>
            }
        }
    </mat-form-field>

    <mat-form-field>
        <mat-label>
            Username
        </mat-label>
        <input matInput type="text" formControlName="username">
        @if(form.get('username').hasError("duplicateUsername")) {
            <mat-error>Username is already registered</mat-error>
            } @else {
            @if(form.get('username').invalid && form.get('username').touched) {
            <mat-error>
                {{form.get('username').hasError('minLength') ? form.get('username').getError('message') : 'Username is required'}}
            </mat-error>
                }
            }
    </mat-form-field>

    <mat-form-field>
        <mat-label>
            Password
        </mat-label>
        <input matInput type="password" formControlName="password">
        @if(form.get('password').invalid && form.get('password').touched) {
        <mat-error>
            Password is missing or invalid. (Password must contain at least one digit and has a minimum length of 6 characters).
        </mat-error>
        }
    </mat-form-field>

    <mat-form-field>
        <mat-label>
            Confirm Password
        </mat-label>
        <input matInput type="password" formControlName="confirmPassword">
        @if (form.get("confirmPassword").hasError('passwordMissmatch')) {
        <mat-error>Password do not match</mat-error>
        } @else {
        @if(form.get('confirmPassword').invalid && form.get('confirmPassword').touched) {
        <mat-error>
            Password is missing or invalid
        </mat-error>
            }
        }
    </mat-form-field>

    <mat-form-field>
        <mat-label>
            Phone Number
        </mat-label>
        <input matInput type="text" formControlName="phoneNumber">
        @if(form.get('phoneNumber').invalid && form.get('phoneNumber').touched) {
        <mat-error>
            Phone Number is invalid
        </mat-error>
        }
    </mat-form-field>

    <mat-form-field>
        <mat-label>
            City
        </mat-label>
        <input matInput type="text" formControlName="city">
        @if(form.get('city').invalid && form.get('city').touched) {
        <mat-error>
            City is invalid
        </mat-error>
        }
    </mat-form-field>

    <mat-form-field>
        <mat-label>
            Address
        </mat-label>
        <input matInput type="text" formControlName="address">
        @if(form.get('address').invalid && form.get('address').touched) {
        <mat-error>
            Address is invalid
        </mat-error>
        }
    </mat-form-field>

    <mat-form-field>
        <mat-label>
            Number
        </mat-label>
        <input matInput type="text" formControlName="number">
        @if(form.get('number').invalid && form.get('number').touched) {
        <mat-error>
            Number is invalid
        </mat-error>
        }
    </mat-form-field>

    <button mat-flat-button [disabled]="form.invalid" (click)="onSubmit(form.value)"> Register
    </button>

</form>

    @if(registrationStatus.message) {
        <div class="mt-4">
            <span class="text-danger fs-5">Errors: </span>
            <ul>
                @for (error of allErrorMessages; track error) {
                    <li>{{error}}</li>
                }
              </ul>
        </div>
    }

} @else {
    @if (registrationStatus.success) {
        <div class="mt-3">
            <span class="fs-6" >
            <span class="fw-semibold success-text">Success:</span> {{registrationStatus.message}}
            <p class="fs-5 pt-3">Continue to the <a role="button" routerLink="/login-signup" class="success-text">Login page</a> </p>
            </span>
        </div>
    }
}

